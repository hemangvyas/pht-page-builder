/*! pht-page-builder 2.1 phtpb-admin.min.js */
function initialize(){}function loadScript(){var a=document.createElement("script");a.type="text/javascript",a.src=phtpb_data.gmaps_url,document.body.appendChild(a)}var peHaaThemesPageBuilder=peHaaThemesPageBuilder||{},peHaaThemesPageBuilder_Events=_.extend({},Backbone.Events);!function(a){"use strict";function b(b,c){var d;return c="undefined"!=typeof c?c:!1,d="undefined"!=typeof window.tinyMCE&&window.tinyMCE.get(b)&&!window.tinyMCE.get(b).isHidden()?window.tinyMCE.get(b).getContent():a("#"+b).val(),c&&"undefined"!=typeof window.tinyMCE&&(d=d.replace(/<p>\[/g,"["),d=d.replace(/<br>\[/g,"["),d=d.replace(/\]<\/p>/g,"]")),d.trim()}function c(b,c){"undefined"!=typeof window.tinyMCE&&window.tinyMCE.get(b)&&!window.tinyMCE.get(b).isHidden()?(c=switchEditors.wpautop(c),window.tinyMCE.get(b).setContent(c,{format:"html"}),setTimeout(function(){window.tinyMCE.get("content").focus()},50)):a("#"+b).val(c)}var d=_.keys(phtpb_data.elements),e=d.join("|");peHaaThemesPageBuilder.Module=Backbone.Model.extend({defaults:{type:"element"}}),peHaaThemesPageBuilder.Modules=Backbone.Collection.extend({model:peHaaThemesPageBuilder.Module,moduleNumber:0,views:[],addView:function(a,b){var c=this.views;c[a]=b,this.views=c},getView:function(a){return this.views[a]},getChildViews:function(a){var b=this.views,c={};return _.each(b,function(b,d){b.model.attributes.parent===a&&(c[d]=b)}),c},setNewParentID:function(a,b){var c=this.views;c[a].model.attributes.parent=b,this.views=c},removeViewAndModel:function(a){var b=a.attributes.phtpb_cid,c=this.getView(b);this.removeView(b),c.remove(),this.remove(a)},removeView:function(a){var b=this.views,c={};_.each(b,function(b,d){d.toString()!==a.toString()&&(c[d]=b)}),this.views=c},generateNewId:function(){var a=this.moduleNumber+1;return this.moduleNumber=a,a},generateTemplateName:function(a,b){var c=b?"-modal":"";return"#phtpb_builder-"+a+c+"-template"},getNumberOfModules:function(a){var b=this.views,c=0;return _.each(b,function(b){b.model.attributes.phtpb_admin_type===a&&c++}),c},selfReset:function(){return this.moduleNumber=0,this.views=[],this.models=[],this}}),peHaaThemesPageBuilder.ElementView=Backbone.View.extend({events:{"click .phtpb_open-modal":"openModal","click .phtpb_remove":"removeMe","click .phtpb_clone":"cloneMe"},connectWith:!1,sortableItems:"> *",cancelDrag:".phtpb_drag_disabled, .phtpb_drag_disabled--hard",initialize:function(){this.$el.attr("data-phtpb_cid",this.model.get("phtpb_cid")),this.elementClass="phtpb_"+this.model.attributes.phtpb_admin_type+" phtpb_block phtpb_block--small",this.addMoreClassesToEl(),this.addEventsAndListeners()},addMoreClassesToEl:function(){},addEventsAndListeners:function(){},renameElement:function(){this.$el.children(".phtpb_js-module-title").find(".phtpb_js-module-title__string").html(this.model.get("admin_label"))},render:function(){return _.isUndefined(this.template)&&(this.template=_.template(a(this.collection.generateTemplateName(this.model.get("phtpb_admin_type"),!1)).html())),this.$el.addClass(this.elementClass).html(this.template(this.model.toJSON())),this.makeChildrenSortable(),this},makeChildrenSortable:function(){var b=this;_.isUndefined(this.sortableElement)||this.$el.find(this.sortableElement).sortable({connectWith:this.connectWith,cancel:this.cancelDrag,items:this.sortableItems,placeholder:"sortable-placeholder",tolerance:"pointer",cursorAt:{left:5},start:function(b,c){window.hasToUpdateContent=!1,a(c.item).is(".phtpb_module")&&a("#phtpb").addClass("phtpb_disable-section-module"),a(c.item).is(".phtpb_row")&&(a("#phtpb").addClass("phtpb_disable-row-row-row"),a(c.item).find(".phtpb_row").length&&a("#phtpb").addClass("phtpb_disable-row-row"))},stop:function(c,d){a("#phtpb").removeClass("phtpb_disable-section-module").removeClass("phtpb_disable-row-row-row").removeClass("phtpb_disable-row-row"),window.hasToUpdateContent&&(b.collection.setNewParentID(d.item.data("phtpb_cid"),window.newParentId),a(b.sortableElement).parent().is(".phtpb_option-advanced-module-settings")||peHaaThemesPageBuilder_Events.trigger("phtpb_module:triggerUpdatePostContent")),window.hasToUpdateContent=!1},update:function(b,c){if(a(c.item).closest(b.target).length){if(c.item.find(".phtpb_column").length&&c.item.parents(".phtpb_column").parents(".phtpb_column").length)return void a(c.sender).sortable("cancel");if(c.item.is(".phtpb_module")&&!c.item.parents(".phtpb_column").length)return void a(c.sender).sortable("cancel");if(c.item.is(".phtpb_row")&&c.item.find(".phtpb_row").length&&c.item.parents(".phtpb_column").length)return void a(c.sender).sortable("cancel");window.hasToUpdateContent=!0,window.newParentId=c.item.parent()[0].attributes["data-phtpb_cid"].value}}})},checkEventOrigin:function(b){var c=a(b.target),d=c.closest("[data-phtpb_cid]").data("phtpb_cid");return d!==this.model.attributes.phtpb_cid?!1:c.closest(".phtpb_modal_settings_container").length?"modal":"normal"},removeMe:function(a){var b=this.collection.getChildViews(this.model.get("phtpb_cid")),c=!1,d=!1;if(a){if(a.preventDefault(),d=this.checkEventOrigin(a),!d)return}else c=!0;if("section"!==this.model.attributes.phtpb_admin_type?c=!0:this.collection.getNumberOfModules("section")>1&&(c=!0),_.each(b,function(a){a.removeMe()}),c)this.collection.removeViewAndModel(this.model);else{var e=this.model.attributes.phtpb_cid;this.model.attributes={phtpb_admin_type:"section",admin_label:phtpb_data.elements.phtpb_section.title,created:"manually",phtpb_cid:e,module_type:"phtpb_section",admin_collapsed:!1}}a&&"normal"===d&&peHaaThemesPageBuilder_Events.trigger("phtpb_module:triggerUpdatePostContent"),peHaaThemesPageBuilder_Events.trigger("phtpb_module:afterDelete")},cloneMe:function(a){if(!(a&&(a.preventDefault(),!this.checkEventOrigin(a))||!_.isUndefined(phtpb_data.elements[this.model.attributes.module_type].pht_themes_only)&&phtpb_data.elements[this.model.attributes.module_type].pht_themes_only)){var b=this.$el.clone();this.$el.after(b),peHaaThemesPageBuilder_Events.trigger("phtpb_module:cloned")}},openModal:function(b){if(!b||(b.preventDefault(),this.checkEventOrigin(b))){var c,d=a(b.target).closest("[data-modal-window]").data("modal-window"),e={model:this.model,collection:this.collection,attributes:{"data-parent_phtpb_cid":this.model.get("phtpb_cid")},view:this,modal_window:d,nested:!1};if(a(b.target).parents(".phtpb_js-container").parent().is(".phtpb_option-advanced-module-settings")&&(e.from="inner"),a(b.target).parents(".phtpb_row").parents(".phtpb_column").length&&(e.nested=!0),!_.isUndefined(d))switch(d){case"all_modules":c=new peHaaThemesPageBuilder.ModalAllModulesView(e);break;case"columns_layout":if(e.nested)return;c=new peHaaThemesPageBuilder.ModalColumnsLayoutView(e);break;default:if(!_.isUndefined(phtpb_data.elements[this.model.attributes.module_type].pht_themes_only)&&phtpb_data.elements[this.model.attributes.module_type].pht_themes_only)return;c=new peHaaThemesPageBuilder.ModalSettingsView(e)}a("body").append(c.render().el)}}}),peHaaThemesPageBuilder.SectionView=peHaaThemesPageBuilder.ElementView.extend({sortableElement:".phtpb_section-content",connectWith:".phtpb_section-content, .phtpb_column-content",cancelDrag:"phtpb_column-content, .phtpb_drag_disabled, .phtpb_drag_disabled--hard",addMoreClassesToEl:function(){this.elementClass+=" phtpb_border--none",this.elementClass+=_.isUndefined(this.model.attributes.admin_collapsed)||"true"!==this.model.attributes.admin_collapsed?"":" js-slide-up"},addEventsAndListeners:function(){_.extend(this.events,{"click .phtpb_add-section":"addSection"}),_.extend(this.events,{"click .phtpb_js_handlediv":"toggleSection"}),this.listenTo(this.model,"change:admin_label",this.renameElement)},addSection:function(a){var b=this.collection.generateNewId();a.preventDefault(),this.collection.add([{phtpb_admin_type:"section",module_type:"phtpb_section",phtpb_cid:b,admin_label:phtpb_data.elements.phtpb_section.title,view:this,created:"auto",from:"create_settings",phtpb_admin_mode:phtpb_data.elements.phtpb_section.phtpb_admin_mode,admin_collapsed:!1}])},toggleSection:function(a){a.preventDefault(),this.$el.toggleClass("js-slide-up"),peHaaThemesPageBuilder_Events.trigger("phtpb_module:triggerUpdatePostContent"),this.model.attributes.admin_collapsed=this.$el.is(".js-slide-up")}}),peHaaThemesPageBuilder.RowLayoutView=peHaaThemesPageBuilder.ElementView.extend({addMoreClassesToEl:function(){-1!==this.model.attributes.module_type.indexOf("_inner")&&(this.elementClass+=" "+this.model.attributes.module_type),this.elementClass+=" phtpb_border--none",this.elementClass+=_.isUndefined(this.model.attributes.admin_collapsed)||"true"!==this.model.attributes.admin_collapsed?"":" js-slide-up"},addEventsAndListeners:function(){_.extend(this.events,{"click .phtpb_js_handlediv":"toggleRow"}),this.listenTo(this.model,"change:admin_label",this.renameElement)},toggleRow:function(a){a.preventDefault(),a.stopPropagation(),this.$el.toggleClass("js-slide-up"),peHaaThemesPageBuilder_Events.trigger("phtpb_module:triggerUpdatePostContent"),this.model.attributes.admin_collapsed=this.$el.is(".js-slide-up")}}),peHaaThemesPageBuilder.ColumnView=peHaaThemesPageBuilder.ElementView.extend({sortableElement:".phtpb_column-content",connectWith:".phtpb_column-content, .phtpb_section-content",addMoreClassesToEl:function(){-1!==this.model.attributes.module_type.indexOf("_inner")&&(this.elementClass+=" "+this.model.attributes.module_type)}}),peHaaThemesPageBuilder.ModuleView=peHaaThemesPageBuilder.ElementView.extend({sortableElement:".phtpb_js-container",connectWith:!1,sortableItems:".phtpb_advanced_twin:not('.phtpb_not-sortable')",addMoreClassesToEl:function(){this.elementClass+=" "+this.model.attributes.module_type,"parent"===this.model.attributes.phtpb_admin_mode?(this.elementClass+=" phtpb_parent",this.elementClass+=" phtpb_first-level"):"advanced_twin"===this.model.attributes.phtpb_admin_mode||"advanced_child"===this.model.attributes.phtpb_admin_mode?this.elementClass+=" phtpb_advanced phtpb_"+this.model.attributes.phtpb_admin_mode:"simple"===this.model.attributes.phtpb_admin_mode&&(this.elementClass+=" phtpb_first-level"),"phtpb_marker"===this.model.attributes.module_type&&(this.elementClass+=" phtpb_not-sortable"),this.elementClass+=" phtpb_border--tiny",this.elementClass+=!_.isUndefined(phtpb_data.elements[this.model.attributes.module_type].pht_themes_only)&&phtpb_data.elements[this.model.attributes.module_type].pht_themes_only?" phtpb_drag_disabled--hard phtpb_disabled":!_.isUndefined(phtpb_data.elements[this.model.attributes.module_type].is_disabled)&&phtpb_data.elements[this.model.attributes.module_type].is_disabled?" phtpb_drag_disabled--hard phtpb_disabled":" phtpb_colorblock"},addEventsAndListeners:function(){_.extend(this.events,{"click .phtpb_add-child":"addChild"}),this.listenTo(this.model,"change:admin_label",this.renameElement)},addChild:function(b){b.preventDefault();var c=a(b.currentTarget).attr("data-module_type"),d={phtpb_admin_type:"module",phtpb_cid:this.collection.generateNewId(),module_type:c,admin_label:phtpb_data.elements[c].title,parent:this.model.attributes.phtpb_cid,view:this,phtpb_admin_mode:phtpb_data.elements[c].phtpb_admin_mode,child:phtpb_data.elements[c].child,from:"create_settings"};this.collection.add([d])}}),peHaaThemesPageBuilder.ModalView=window.wp.Backbone.View.extend({events:{"click .phtpb_cancel-modal-action":"cancelModalAction","click .phtpb_do-modal-action":"doModalAction","click .phtpb_do-inner-modal-action":"doInnerModalAction"},className:"phtpb_modal_settings_container",template:_.template(a("#phtpb_builder-modal-template").html()),innerTemplateData:{},render:function(){var a="";return"column"===this.options.model.attributes.phtpb_admin_type&&(a=!_.isUndefined(this.options.nested)&&this.options.nested?" phtpb_modal__column-inner":""),this.$el.addClass("phtpb_modal__"+this.options.modal_window).addClass("phtpb_modal__"+this.options.model.attributes.phtpb_admin_type+a).html(this.template(_.extend(this.model.toJSON(),{modal_window:this.options.modal_window}))),_.isUndefined(this.innerTemplate)||(this.container=this.$(".phtpb_modal-container"),this.$el.append(this.innerTemplate(this.innerTemplateData))),this.advancedRender(),this.addOverlay(),this},resetFields:function(){this.$el.find(".phtpb_color-picker-hex").each(function(){a("label[for="+a(this).attr("id")+"]").trigger("click")}),this.$("#phtpb_content_new").length&&(_.isUndefined(window.switchEditors)||window.switchEditors.go("phtpb_content_new","tinymce"),"undefined"!=typeof window.tinyMCE&&(window.tinyMCE.execCommand("mceRemoveEditor",!1,"phtpb_content_new"),"undefined"!=typeof window.tinyMCE.get("phtpb_content_new")&&window.tinyMCE.remove("#phtpb_content_new")))},cancelModalAction:function(a){a.preventDefault(),this.removeOverlay(),this.resetFields(),"parent"===this.model.attributes.phtpb_admin_mode&&"create_settings"!==this.options.from&&peHaaThemesPageBuilder_Events.trigger("phtpb_module:reInitialized"),("create_settings"===this.options.from||!_.isUndefined(this.options.fromAction)&&"addChild"===this.options.fromAction)&&this.collection.removeViewAndModel(this.model),this.remove()},doInnerModalAction:function(){},addOverlay:function(){a("body").is(".phtpb_stop_scroll")||(this.overlay=!0,a("body").addClass("phtpb_stop_scroll"))},removeOverlay:function(){!_.isUndefined(this.overlay)&&this.overlay&&(this.overlay=!1,a("body").removeClass("phtpb_stop_scroll"))},doModalAction:function(){},advancedRender:function(){}}),peHaaThemesPageBuilder.ModalSettingsView=peHaaThemesPageBuilder.ModalView.extend({initialize:function(){_.extend(this.events,{"click .phtpb_address-to-geocode":"addressToGeocode","click .phtpb_upload-button":"openMediaFrame","click .phtpb_icons-list__icon":"chooseIcon","change :checkbox":"conditionalFields","change select":"conditionalFields"}),this.listenTo(peHaaThemesPageBuilder_Events,"phtpb_map-marker:modified",this.rerenderMap),this.listenTo(peHaaThemesPageBuilder_Events,"phtpb_module:afterDelete",this.rerenderMap),this.innerTemplate=_.template(a(this.collection.generateTemplateName(this.model.get("module_type"),!0)).html()),this.innerTemplateData={phtpb_attributes:this.model.attributes}},conditionalFields:function(b){var c,d=a(b.target);if(d.is(":checkbox"))d.parent().toggleClass("checked").toggleClass("unchecked");else if(d.is("select")){c=d.find("option:selected").val();var e=d.parent().attr("class").replace(/select-[^\s]+/,"select-"+c);d.parent().attr("class",e)}},chooseIcon:function(b){var c=a(b.target);b.preventDefault(),c.siblings(".phtpb_icons-list__icon--active").removeClass("phtpb_icons-list__icon--active"),c.addClass("phtpb_icons-list__icon--active").parent().next(".phtpb_shortcode-attribute").val(c.attr("data-icon-class"))},openMediaFrame:function(b){function c(a){setTimeout(function(){a.find(".gallery-settings").remove()},10)}b.preventDefault();var d,e=this,f=a(b.target);if(void 0!==d)return void d.open();if(f.is(".phtpb_gallery-button")){var g=f.siblings(".phtpb_gallery-ids-field"),h=g.val().length?g.val():"0",i='[gallery ids="'+h+'"]';d=wp.media.frames.phtpb_file_frame=wp.media.gallery.edit(i),g.val().length||d.setState("gallery-library"),c(d.$el),d.on("content:render:browse",function(a){c(a.$el)}),d.state("gallery-edit").on("update",function(a){var b=wp.media.gallery.shortcode(a).attrs.named;b.ids&&g.val(b.ids),e.displayGalleryCount(f,!0)})}else d=wp.media.frames.phtpb_file_frame=wp.media({title:f.data("choose"),library:{type:f.data("type")},button:{text:f.data("update")},multiple:!1}),d.on("select",function(){var a,b=d.state().get("selection").first().toJSON();a=_.isUndefined(b.sizes)||_.isUndefined(b.sizes.thumbnail)?b.url:b.sizes.thumbnail.url,f.siblings(".phtpb_upload-field").val(a),f.parent().next(".phtpb_option").find(".phtpb_upload-field-id").val(b.id),e.previewImage(f),e.previewVideo(f)}),d.open()},previewImage:function(b){var c=b.siblings(".phtpb_upload-field"),d=c.siblings(".phtpb_upload-preview"),e=c.val().trim();if("image"===b.data("type")){if(""===e)return void(d.length&&d.remove());d.length||(b.after('<div class="phtpb_upload-preview"><img src=""/><a href="#" class="fa fa-times-circle phtpb_remove_image phtpb_close_icon" title="'+phtpb_data.rmv_img+'"></a></div>'),d=c.siblings(".phtpb_upload-preview"),this.$el.on("click",".phtpb_remove_image",function(b){b.preventDefault(),a(this).parents(".phtpb_option").find(".phtpb_upload-field").val("").end().next(".phtpb_option").find(".phtpb_upload-field-id").val(""),a(this).parent().remove()})),d.find("img").attr("src",e)}},previewVideo:function(b){var c=b.siblings(".phtpb_upload-field"),d=c.siblings(".phtpb_upload-preview"),e=c.val().trim();if("video"===b.data("type")){if(""===e)return void(d.length&&d.remove());d.length||(b.after('<div class="phtpb_upload-preview"><span></span><a href="#" class="fa fa-times-circle phtpb_remove_video phtpb_close_icon" title="'+phtpb_data.rmv_img+'"></a></div>'),d=c.siblings(".phtpb_upload-preview"),this.$el.on("click",".phtpb_remove_video",function(b){b.preventDefault(),a(this).parents(".phtpb_option").find(".phtpb_upload-field").val("").end().next(".phtpb_option").find(".phtpb_upload-field-id").val(""),a(this).parent().remove()})),d.find("span").html(e)}},displayGalleryCount:function(a,b){var c,d=a.siblings(".phtpb_gallery-ids-field").val();""!==d&&(c=d.split(",").length,a.siblings(".phtpb_visual-feedback").addClass(b?"phtpb_just-updated":" ").find(".phtpb_count").html(c))},advancedRender:function(){var b,d,e,f,g,h=this,i=this.$el,j="";b=this.$el.find("#phtpb_content_new"),e=this.$el.find(".phtpb_upload-button"),f=this.$el.find(".phtpb_gallery-button"),g=this.$el.find(".phtpb_color-picker-hex"),g.wpColorPicker(),e.siblings(".phtpb_upload-field").on("input",function(){h.previewImage(a(this).siblings(".phtpb_upload-button")),h.previewVideo(a(this).siblings(".phtpb_upload-button"))}).each(function(){h.previewImage(a(this).siblings(".phtpb_upload-button")),h.previewVideo(a(this).siblings(".phtpb_upload-button"))}),f.each(function(){h.displayGalleryCount(a(this),!1)}),b.length&&(d=b.closest(".phtpb_option"),j=b.html(),b.remove(),d.children("label").length?d.children("label").after(peHaaThemesPageBuilder.initial_content):d.prepend(peHaaThemesPageBuilder.initial_content),setTimeout(function(){_.isUndefined(window.switchEditors)||window.switchEditors.go("phtpb_content_new","html"===getUserSetting("editor")?"html":"tinymce"),c("phtpb_content_new",j),window.wpActiveEditor="phtpb_content_new"},10));var k=a('.phtpb_module-content[data-phtpb_cid="'+this.model.attributes.phtpb_cid+'"]');this.$(".phtpb_option-advanced-module-settings").prepend(k),this.copy=k.clone(),this.renderMap(!0),setTimeout(function(){i.find("select, input, textarea, radio").filter(":eq(0)").focus()},1)},doModalAction:function(c){var d={},e="";c.preventDefault(),this.$(".phtpb_shortcode-attribute").each(function(){var b=a(this),c=b.val(),f=b.attr("id"),g=b.attr("data-default");b.is('input[type="checkbox"]')?c=b.is(":checked")?"yes":"":b.is("input")&&""!==c&&(c=c.replace(/("|\[|\])/g,""),c=_.escape(c)),d[f]=c,(_.isUndefined(g)||c!==g)&&(e+=f+'="'+c+'" ')}),this.$("textarea, #phtpb_content_main").each(function(){var c=a(this),e="";c.is("#phtpb_content_main")?e=c.html():c.is("textarea#phtpb_content_new")&&(e=b("phtpb_content_new")),d.phtpb_content_new=e}),d.shortcodeAttributesString="","column"===this.model.attributes.phtpb_admin_type&&(d.shortcodeAttributesString='layout="'+this.model.attributes.layout+'" '),d.shortcodeAttributesString+=e,a('.phtpb_parent[data-phtpb_cid="'+this.model.attributes.phtpb_cid+'"]').find(".phtpb_controls").after(this.$(".phtpb_js-container")),this.model.set(d),(_.isUndefined(this.options.from)||"inner"!==this.options.from)&&peHaaThemesPageBuilder_Events.trigger("phtpb_module:triggerUpdatePostContent"),this.resetFields(),this.remove(),this.removeOverlay(),"phtpb_marker"===this.model.attributes.module_type&&peHaaThemesPageBuilder_Events.trigger("phtpb_map-marker:modified")},doInnerModalAction:function(b){var c=a(b.currentTarget).attr("data-module_type");b.preventDefault(),_.isUndefined(c)||_.isUndefined(phtpb_data.elements[c])||this.collection.add([{phtpb_admin_type:"module",phtpb_cid:this.collection.generateNewId(),module_type:c,admin_label:phtpb_data.elements[c].title,parent:this.model.attributes.phtpb_cid,view:this,phtpb_admin_mode:phtpb_data.elements[c].phtpb_admin_mode,child:phtpb_data.elements[c].child,from:"inner",fromAction:"addChild"}])},addressToGeocode:function(b){var c=this,d=a(b.target).closest(".phtpb_modal_settings_container");if(d.length){var e=d.find("input[class*='map_address']"),f=e.val();if(!e.length||""===f)return;var g=new google.maps.Geocoder;g.geocode({address:f},function(a,b){if(b===google.maps.GeocoderStatus.OK){var f=a[0];e.val(f.formatted_address),d.find("input[class*='lat']").val(f.geometry.location.lat()),d.find("input[class*='lng']").val(f.geometry.location.lng()),"phtpb_google_map"===c.model.attributes.module_type&&c.map.setCenter(f.geometry.location)}else alert("Geocode was not successful for the following reason: "+b)})}},rerenderMap:function(){"phtpb_google_map"===this.model.attributes.module_type&&this.renderMap(!1)},addMarkers:function(){var a=this,b=a.collection.getChildViews(a.model.attributes.phtpb_cid),c={},d=new google.maps.LatLngBounds;"undefined"!=typeof a.map.getBounds()&&(d=a.map.getBounds()),_.each(b,function(b,d){var e=b.model.attributes.marker_lat,f=b.model.attributes.marker_lng,g=_.isUndefined(b.model.attributes.marker_title)||""===b.model.attributes.marker_title.trim()?b.model.attributes.map_address:b.model.attributes.marker_title,h=new google.maps.LatLng(parseFloat(e),parseFloat(f));c[d]=new google.maps.Marker({map:a.map,position:h,title:g})})},renderMap:function(a){if("object"==typeof google&&"object"==typeof google.maps){var b=this,c=this.$el.find(".phtpb_js-map"),d=this.$el.find("#lat"),e=this.$el.find("#lng"),f=this.$el.find("#zoom");c.length&&setTimeout(function(){b.map=new google.maps.Map(c[0],{center:new google.maps.LatLng(d.val(),e.val()),zoom:parseInt(f.val()),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1}),setTimeout(function(){b.addMarkers(a)},100),google.maps.event.addListener(b.map,"center_changed",function(){var a=b.map.getCenter();d.val(a.lat()),e.val(a.lng())}),google.maps.event.addListener(b.map,"zoom_changed",function(){f.val(b.map.getZoom())})},10)}}}),peHaaThemesPageBuilder.ModalAllModulesView=peHaaThemesPageBuilder.ModalView.extend({innerTemplateData:{},initialize:function(){this.innerTemplate=_.template(a("#phtpb_builder-all-modules-modal-template").html())},doModalAction:function(b){var c=a(b.currentTarget).attr("data-module_type");b.preventDefault(),this.remove(),this.removeOverlay(),this.collection.add([{phtpb_admin_type:"module",phtpb_cid:this.collection.generateNewId(),module_type:c,admin_label:phtpb_data.elements[c].title,parent:this.attributes["data-parent_phtpb_cid"],view:this.options.view,phtpb_admin_mode:phtpb_data.elements[c].phtpb_admin_mode,child:phtpb_data.elements[c].child,add_submodule:phtpb_data.elements[c].add_submodule,from:"create_settings"}])}}),peHaaThemesPageBuilder.ModalColumnsLayoutView=peHaaThemesPageBuilder.ModalView.extend({initialize:function(){this.innerTemplate=_.template(a("#phtpb_builder-columns-modal-template").html())},doModalAction:function(b){b.preventDefault();var c=this.collection.generateNewId(),d=a(b.target).is("li")?a(b.target):a(b.target).closest("li"),e=d.data("layout").split(","),f=this.attributes["data-parent_phtpb_cid"];this.collection.add([{phtpb_admin_type:"row",module_type:"phtpb_row",phtpb_cid:c,parent:f,view:this.options.view,columnlayout:e,phtpb_admin_mode:phtpb_data.elements.phtpb_row.phtpb_admin_mode,admin_collapsed:!1}]),this.remove(),this.removeOverlay(),b&&peHaaThemesPageBuilder_Events.trigger("phtpb_module:triggerUpdatePostContent")}}),peHaaThemesPageBuilder.AppView=window.wp.Backbone.View.extend({template:_.template(a("#phtpb_builder-app-template").html()),initialize:function(){this.listenTo(this.collection,"add",this.addModule),this.listenTo(peHaaThemesPageBuilder_Events,"phtpb_module:cloned",this.onClone),this.listenTo(peHaaThemesPageBuilder_Events,"phtpb_module:triggerUpdatePostContent",this.updatePostContent),this.listenTo(peHaaThemesPageBuilder_Events,"phtpb_module:reInitialized",this.reInitialize),this.render(),this.reInitialize(!1,this.options.start_data)},render:function(){return a("#phtpb_main_container").append(this.$el.html(this.template())),setTimeout(function(){a(".phtpb_preloader").addClass("phtpb_loaded").remove(),a("#phtpb_main_container").addClass("phtpb_main_container-loaded")},600),this.$el.sortable({cancel:".add-row-layout, .phtpb_modal-bottom-container, .phtpb_row, #phtpb_layout_controls, .phtpb_drag_disabled, .phtpb_drag_disabled--hard",placeholder:"sortable-placeholder",tolerance:"pointer",update:function(){peHaaThemesPageBuilder_Events.trigger("phtpb_module:triggerUpdatePostContent")}}),this},reInitialize:function(a,c){var d,e,f,g="phtpb_secondeditor",h=b("content",!0);if(_.isUndefined(c)||(g=c),d=b(g,!0),e=""===d,this.removeAllSections(),e?-1===h.indexOf("[phtpb_section")?(""!==h&&(d='[phtpb_row][phtpb_column layout="4_4"][phtpb_text phtpb_width="1"]'+h+"[/phtpb_text][/phtpb_column][/phtpb_row]"),d="[phtpb_section]"+d+"[/phtpb_section]"):d=h:-1===d.indexOf("[phtpb_section")&&(d='[phtpb_section][phtpb_row][phtpb_column layout="4_4"][phtpb_text phtpb_width="1"]'+d+"[/phtpb_text][/phtpb_column][/phtpb_row][/phtpb_section]"),this.createLayoutFromContent(d),(_.isUndefined(a)||!a)&&(f=this.updatePostContent(),f!==d)){{alert(phtpb_data.confirmation)}console.log(f),console.log(d),this.removeAllSections(),this.createLayoutFromContent(f)}},pageBuilderIsActive:function(){return this.$builder_toggle_button.hasClass("phtpb_builder_is_used")},wp_regexp_not_global:_.memoize(function(a){return new RegExp("\\[(\\[?)("+a+")(?![\\w-])([^\\]\\/]*(?:\\/(?!\\])[^\\]\\/]*)*?)(?:(\\/)\\]|\\](?:([^\\[]*(?:\\[(?!\\/\\2\\])[^\\[]*)*)(\\[\\/\\2\\]))?)(\\]?)")}),createLayoutFromContent:function(a,b){var c=this,d=window.wp.shortcode.regexp(e),f=this.wp_regexp_not_global(e),g=a.match(d);_.each(g,function(a){var e,g,h=a.match(f),i=h[2],j=""!==h[3]?window.wp.shortcode.attrs(h[3]):"",k=h[5],l=c.collection.generateNewId(),m={},n=!_.isUndefined(k)&&""!==k&&k.match(d);if(g=h[3].replace(/(\"\S+\")([^(\s|\])])/,"$1"),e={phtpb_admin_type:phtpb_data.elements[i].phtpb_admin_type,phtpb_cid:l,created:"manually",module_type:i,admin_label:phtpb_data.elements[i].title,shortcodeAttributesString:g,phtpb_admin_mode:phtpb_data.elements[i].phtpb_admin_mode,child:phtpb_data.elements[i].child},"section"!==e.phtpb_admin_type&&(e.parent=b),_.isObject(j.named)){for(var o in j.named)m[o]=j.named[o];e=_.extend(e,m)}n||(e.phtpb_content_new=k),c.collection.add([e]),n&&c.createLayoutFromContent(k,l)})},insertModuleToLayout:function(b,c){"advanced_twin"===b.get("phtpb_admin_mode")||"advanced_child"===b.get("phtpb_admin_mode")?a('.phtpb_module-content[data-phtpb_cid="'+b.get("parent")+'"]').append(c.render().el):this.collection.getView(b.get("parent")).$el.children(".phtpb_js-container").children(".phtpb_insert-module").length?this.collection.getView(b.get("parent")).$el.children(".phtpb_js-container").children(".phtpb_insert-module").before(c.render().el):this.collection.getView(b.get("parent")).$el.children(".phtpb_js-container").append(c.render().el)},addModule:function(a){var b,c=this,d={model:a,collection:this.collection,attributes:{"data-phtpb_cid":a.get("phtpb_cid")}};switch(a.get("phtpb_admin_type")){case"section":b=new peHaaThemesPageBuilder.SectionView(d),this.collection.addView(a.get("phtpb_cid"),b),_.isUndefined(a.get("view"))?this.$el.append(b.render().el):a.get("view").$el.after(b.render().el),this.maybeOpenSettings(a,d);break;case"row":b=new peHaaThemesPageBuilder.RowLayoutView(d),this.collection.addView(a.get("phtpb_cid"),b),this.insertModuleToLayout(a,b);var e=b.model.attributes.columnlayout;_.each(e,function(a){var d={phtpb_admin_type:"column",module_type:"phtpb_column",phtpb_cid:c.collection.generateNewId(),parent:b.model.get("phtpb_cid"),layout:a,view:b,shortcodeAttributesString:'layout="'+a+'"',phtpb_admin_mode:"simple"};c.collection.add([d])});break;case"column":d.className="phtpb_column phtpb_column-"+a.get("layout"),b=new peHaaThemesPageBuilder.ColumnView(d),this.collection.addView(a.get("phtpb_cid"),b),this.insertModuleToLayout(a,b);break;case"module":b=new peHaaThemesPageBuilder.ModuleView(d),this.insertModuleToLayout(a,b),this.collection.addView(a.get("phtpb_cid"),b),"manually"!==a.get("created")&&("parent"!==a.get("phtpb_admin_mode")||_.isUndefined(phtpb_data.elements[a.attributes.module_type].kids)||_.each(phtpb_data.elements[a.attributes.module_type].kids,function(a){var d={phtpb_admin_type:"module",created:"manually",module_type:a,phtpb_cid:c.collection.generateNewId(),parent:b.model.get("phtpb_cid"),view:b,admin_label:phtpb_data.elements[a].title,phtpb_admin_mode:"advanced_child"};c.collection.add([d])}),this.maybeOpenSettings(a,d))}},maybeOpenSettings:function(b,c,d){var e;_.isUndefined(d)&&(d="manually"!==b.get("created")&&phtpb_data.elements[b.attributes.module_type].create_with_settings),d?(_.isUndefined(b.get("from"))||(c.from=b.get("from")),_.isUndefined(b.get("fromAction"))||(c.fromAction=b.get("fromAction")),c.modal_window="settings",e=new peHaaThemesPageBuilder.ModalSettingsView(c),a("body").append(e.render().el)):"manually"!==b.get("created")&&peHaaThemesPageBuilder_Events.trigger("phtpb_module:triggerUpdatePostContent")},moduleToModel:function(a){var b=a.data("phtpb_cid"),c=this.collection.find(function(a){return a.get("phtpb_cid")===b});return c},updatePostContent:function(){var a=this.generateModuleShortcode();return c("phtpb_secondeditor",a),c("content",a),a},generateModuleShortcode:function(b,c){var d,e,f,g,h=this,i="",j="",k=1,l={section:".phtpb_row",row:".phtpb_column",column:".phtpb_first-level, .phtpb_row",module:".phtpb_advanced"},m={fullwidth:100,"4_4":1,"3_4":.75,"2_3":.66,"1_2":.5,"1_3":.33,"1_4":.25};if(_.isUndefined(b))this.$el.find(".phtpb_section").each(function(){i+=h.generateModuleShortcode(a(this),1)});else{if(e=h.moduleToModel(b),g=e.attributes.module_type,"phtpb_row"===e.attributes.module_type&&(_.isUndefined(e.attributes.wrapper)||"normal"===e.attributes.wrapper||(k=100)),"phtpb_row_inner"===e.attributes.module_type&&(g="phtpb_row"),"phtpb_column_inner"===e.attributes.module_type&&(g="phtpb_column"),"phtpb_column"===g&&(k*=m[e.attributes.layout]),"phtpb_row"!==g&&"phtpb_column"!==g||!b.parents(".phtpb_column").length||(j="_inner"),d=_.isUndefined(e.attributes.shortcodeAttributesString)||""===e.attributes.shortcodeAttributesString.trim()?"":" "+e.attributes.shortcodeAttributesString.trim(),"module"===e.attributes.phtpb_admin_type&&(f=Math.ceil(10*c)/10,-1==d.search(/phtpb_width=([^\s]*)/)?d+=' phtpb_width="'+f+'"':d=d.replace(/phtpb_width=([^\s]*)/,'phtpb_width="'+f+'"')),"section"===e.attributes.phtpb_admin_type||"row"===e.attributes.phtpb_admin_type){var n=b.is(".js-slide-up");-1==d.search(/admin_collapsed=([^\s]*)/)?n&&(d+=' admin_collapsed="'+n+'"'):d=d.replace(/admin_collapsed=([^\s]*)/,'admin_collapsed="'+n+'"')}i+="["+g+j+d+"]",_.isUndefined(e.attributes.phtpb_content_new)||"module"!==e.attributes.phtpb_admin_type||"parent"===e.attributes.phtpb_admin_mode?b.children(".phtpb_js-container").children(l[e.attributes.phtpb_admin_type]).each(function(){i+=h.generateModuleShortcode(a(this),c*k)}):i+=e.attributes.phtpb_content_new,i+="[/"+g+j+"]"}return i},removeAllSections:function(){var b=this;this.$el.find(".phtpb_section-content").each(function(){var c=a(this),d=b.collection.getView(c.data("phtpb_cid"));_.isUndefined(d)||d.removeMe()}),b.collection.selfReset()},onClone:function(){var b=this;a("#phtpb_main_container").addClass("event-inactive").find(".phtpb_block").addClass("phtpb_drag_disabled"),this.updatePostContent();var c=a("#phtpb .inside").height();a("#phtpb .inside").css("min-height",c+"px"),setTimeout(function(){b.$el.find(".phtpb_section").remove(),
b.reInitialize(!1),a("#phtpb .inside").css("min-height",0),a("#phtpb_main_container").removeClass("event-inactive").find(".phtpb_block").removeClass("phtpb_drag_disabled")},500)}}),a(document).ready(function(){var b,c=a("body").find("#phtpb_toggle_builder-meta"),d=c.is(".phtpb_builder_is_used"),e=d,f=a("#phtpb_state-yes"),g=a("#phtpb"),h=a("#phtpb_main_editor_wrap"),i=a("#phtpb_hidden_editor");peHaaThemesPageBuilder.initial_content=i.html(),i.remove(),!0===d?(b=new peHaaThemesPageBuilder.AppView({model:peHaaThemesPageBuilder.Module,collection:new peHaaThemesPageBuilder.Modules,start_data:"phtpb_secondeditor"}),g.addClass("phtpb_visible"),e=!0,d=!0):g.addClass("phtpb_hidden"),a(document).on("click",".js-phtpb_toggle_builder",function(c){c.preventDefault();var i=a(this).data("content-source");return i?(a(this).siblings(".phtpb_table--cell").remove(),!0===e?(e=!1,a(".phtpb_use_default, .phtpb_use_pb").toggleClass("js-hidden"),a(this).toggleClass("button-primary"),h.addClass("phtpb_hide_pd phtpb_show_second_editor")):!1===e&&!1===d?(b=new peHaaThemesPageBuilder.AppView({model:peHaaThemesPageBuilder.Module,collection:new peHaaThemesPageBuilder.Modules,start_data:i}),a(this).addClass("phtpb_builder_is_used").removeClass("button-primary"),a(".phtpb_activate_pb").addClass("js-hidden"),a(".phtpb_use_default").removeClass("js-hidden"),h.addClass("phtpb_hidden phtpb_activated").removeClass("phtpb_not_activated"),f.prop("checked",!0),d=!0,e=!0):!1===e&&!0===d&&(b.remove(),b.initialize(),a(".phtpb_use_default, .phtpb_use_pb").toggleClass("js-hidden"),a(this).toggleClass("button-primary"),h.removeClass("phtpb_hide_pd phtpb_show_second_editor"),e=!0),void g.toggleClass("phtpb_hidden").toggleClass("phtpb_visible")):!1})})}(jQuery),window.onload=loadScript;